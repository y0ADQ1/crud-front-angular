<div class="list-people-container">
  <header>
    <h2>Lista de Personas</h2>
    <button (click)="authService.logout()">Cerrar Sesión</button>
  </header>
  <nav>
    <a routerLink="/dashboard">Volver al Dashboard</a>
  </nav>
  <div class="filter-section">
    <label>
      <input type="checkbox" [(ngModel)]="showInactive" (change)="loadPeople()" /> Mostrar inactivos
    </label>
    <button (click)="openCreateForm()">Crear Persona</button>
  </div>
  @if (showCreateForm) {
    <form (ngSubmit)="createPerson()">
      <div class="form-group">
        <label>Nombre:</label>
        <input [(ngModel)]="newPerson.firstName" name="firstName" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <div class="form-group">
        <label>Apellido:</label>
        <input [(ngModel)]="newPerson.lastName" name="lastName" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <div class="form-group">
        <label>Edad:</label>
        <input type="number" [(ngModel)]="newPerson.age" name="age" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <div class="form-group">
        <label>Género:</label>
        <select [(ngModel)]="newPerson.gender" name="gender" required>
          <option value="male">Masculino</option>
          <option value="female">Femenino</option>
        </select>
      </div>
      <div class="form-group">
        <label>Email:</label>
        <input type="email" [(ngModel)]="newPerson.email" name="email" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <div class="form-group">
        <label>Teléfono:</label>
        <input [(ngModel)]="newPerson.phoneNumber" name="phoneNumber" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <button type="submit">Guardar</button>
      <button type="button" (click)="showCreateForm = false">Cancelar</button>
    </form>
  }
  @if (people) {
    <table>
      <thead>
      <tr>
        <th>Nombre</th>
        <th>Apellido</th>
        <th>Edad</th>
        <th>Género</th>
        <th>Email</th>
        <th>Teléfono</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
      </thead>
      <tbody>
        @for (person of people.data; track person.id) {
          <tr>
            <td>{{ person.firstName }}</td>
            <td>{{ person.lastName }}</td>
            <td>{{ person.age }}</td>
            <td>{{ person.gender === 'male' ? 'Masculino' : 'Femenino' }}</td>
            <td>{{ person.email }}</td>
            <td>{{ person.phoneNumber }}</td>
            <td>{{ person.isActive ? 'Activo' : 'Inactivo' }}</td>
            <td>
              <button (click)="editPerson(person)">Editar</button>
              <button (click)="deactivatePerson(person.id)">Desactivar</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
    <div class="pagination">
      <button (click)="loadPeople(pagination.meta.current_page - 1)" [disabled]="pagination.meta.current_page === 1">Anterior</button>
      <span>Página {{ pagination.meta.current_page }} de {{ pagination.meta.last_page }}</span>
      <button (click)="loadPeople(pagination.meta.current_page + 1)" [disabled]="pagination.meta.current_page === pagination.meta.last_page">Siguiente</button>
    </div>
  } @else {
    <p>Cargando personas...</p>
  }
  @if (showEditForm && selectedPerson) {
    <form (ngSubmit)="updatePerson()">
      <div class="form-group">
        <label>Nombre:</label>
        <input [(ngModel)]="selectedPerson.firstName" name="firstName" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <div class="form-group">
        <label>Apellido:</label>
        <input [(ngModel)]="selectedPerson.lastName" name="lastName" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <div class="form-group">
        <label>Edad:</label>
        <input type="number" [(ngModel)]="selectedPerson.age" name="age" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <div class="form-group">
        <label>Género:</label>
        <select [(ngModel)]="selectedPerson.gender" name="gender" required>
          <option value="male">Masculino</option>
          <option value="female">Femenino</option>
        </select>
      </div>
      <div class="form-group">
        <label>Email:</label>
        <input type="email" [(ngModel)]="selectedPerson.email" name="email" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <div class="form-group">
        <label>Teléfono:</label>
        <input [(ngModel)]="selectedPerson.phoneNumber" name="phoneNumber" required />
        <app-error [errors]="errors"></app-error>
      </div>
      <button type="submit">Actualizar</button>
      <button type="button" (click)="showEditForm = false">Cancelar</button>
    </form>
  }
</div>
